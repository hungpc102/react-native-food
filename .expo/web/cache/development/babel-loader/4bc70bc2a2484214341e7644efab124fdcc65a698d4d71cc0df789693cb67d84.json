{"ast":null,"code":"import _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport axios from \"axios\";\nimport { getUserIdToStorage } from \"../../utils/TokenStorage\";\nimport { apiCreateOrder } from \"../../api/OrderAPI\";\nimport { getAccessTokenFromStorage } from \"../../utils/TokenStorage\";\nimport { handleTokenRefresh } from \"../jwtService/jwtServices\";\nexport var createOrder = function () {\n  var _ref = _asyncToGenerator(function* (address, totalPrice, shipPrice) {\n    var callCount = 0;\n    return new Promise(function () {\n      var _ref2 = _asyncToGenerator(function* (resolve, reject) {\n        var createOrderInternal = function () {\n          var _ref3 = _asyncToGenerator(function* () {\n            if (callCount < 2) {\n              try {\n                callCount++;\n                var user_id = yield getUserIdToStorage();\n                if (address === '') {\n                  reject('Vui lòng điền địa chỉ nhận hàng');\n                  return;\n                }\n                var order = {\n                  \"USER_ID\": user_id,\n                  \"ADDRESS\": address,\n                  \"TOTAL_INVOICE\": totalPrice,\n                  \"SHIPPING_FEE\": shipPrice\n                };\n                var accessToken = yield getAccessTokenFromStorage();\n                axios.post(apiCreateOrder, order, {\n                  headers: {\n                    Authorization: `Bearer ${accessToken}`,\n                    'Content-Type': 'application/json'\n                  }\n                }).then(function (response) {\n                  if (response.data.status === 401) {\n                    handleTokenRefresh();\n                    createOrderInternal();\n                  } else {\n                    callCount = 0;\n                    resolve(response.data);\n                  }\n                }).catch(function (error) {\n                  console.log(error.message);\n                  reject('Lỗi khi tạo order');\n                });\n              } catch (error) {\n                reject('Error creating order: ' + error.message);\n              }\n            } else {\n              reject('Đăng nhập hết hạn. Vui lòng đăng nhập lại');\n            }\n          });\n          return function createOrderInternal() {\n            return _ref3.apply(this, arguments);\n          };\n        }();\n        createOrderInternal();\n      });\n      return function (_x4, _x5) {\n        return _ref2.apply(this, arguments);\n      };\n    }());\n  });\n  return function createOrder(_x, _x2, _x3) {\n    return _ref.apply(this, arguments);\n  };\n}();","map":{"version":3,"names":["axios","getUserIdToStorage","apiCreateOrder","getAccessTokenFromStorage","handleTokenRefresh","createOrder","_ref","_asyncToGenerator","address","totalPrice","shipPrice","callCount","Promise","_ref2","resolve","reject","createOrderInternal","_ref3","user_id","order","accessToken","post","headers","Authorization","then","response","data","status","catch","error","console","log","message","apply","arguments","_x4","_x5","_x","_x2","_x3"],"sources":["/Users/chuduchung/Documents/doan-reactnative/react-native-app/react-native-food/services/orderService/createOrder.tsx"],"sourcesContent":["import axios from \"axios\";\nimport { getUserIdToStorage } from \"../../utils/TokenStorage\";\nimport {apiCreateOrder} from '../../api/OrderAPI'\nimport { getAccessTokenFromStorage } from '../../utils/TokenStorage';\nimport {handleTokenRefresh} from '../jwtService/jwtServices'\n\nexport const createOrder = async (address:string, totalPrice:number, shipPrice:number) => {\n    let callCount = 0;\n\n    return new Promise(async (resolve, reject) => {\n        const createOrderInternal = async () => {\n            if (callCount < 2) {\n                try {\n                    callCount++;\n                    const user_id = await getUserIdToStorage();\n\n                    if (address === '') {\n                        reject('Vui lòng điền địa chỉ nhận hàng');\n                        return;\n                    }\n\n                    const order = {\n                        \"USER_ID\": user_id,\n                        \"ADDRESS\": address,\n                        \"TOTAL_INVOICE\": totalPrice,\n                        \"SHIPPING_FEE\": shipPrice\n                    }\n\n                    const accessToken = await getAccessTokenFromStorage();\n\n                    axios.post(apiCreateOrder, order, {\n                        headers: {\n                            Authorization: `Bearer ${accessToken}`,\n                            'Content-Type': 'application/json',\n                        }\n                    })\n                    .then(response => {\n                        if (response.data.status === 401) {\n                            handleTokenRefresh();\n                            createOrderInternal();\n                        } else {\n                            callCount = 0;\n                            resolve(response.data); // Resolve the promise with response.data\n                        }\n                    })\n                    .catch(error => {\n                        console.log(error.message);\n                        reject('Lỗi khi tạo order'); // Reject the promise with an error message\n                    });\n                } catch (error:any) {\n                    reject('Error creating order: ' + error.message); // Reject the promise with an error message\n                }\n            } else {\n                reject('Đăng nhập hết hạn. Vui lòng đăng nhập lại'); // Reject the promise with an error message\n            }\n        }\n\n        createOrderInternal();\n    });\n}\n\n\n"],"mappings":";AAAA,OAAOA,KAAK,MAAM,OAAO;AACzB,SAASC,kBAAkB;AAC3B,SAAQC,cAAc;AACtB,SAASC,yBAAyB;AAClC,SAAQC,kBAAkB;AAE1B,OAAO,IAAMC,WAAW;EAAA,IAAAC,IAAA,GAAAC,iBAAA,CAAG,WAAOC,OAAc,EAAEC,UAAiB,EAAEC,SAAgB,EAAK;IACtF,IAAIC,SAAS,GAAG,CAAC;IAEjB,OAAO,IAAIC,OAAO;MAAA,IAAAC,KAAA,GAAAN,iBAAA,CAAC,WAAOO,OAAO,EAAEC,MAAM,EAAK;QAC1C,IAAMC,mBAAmB;UAAA,IAAAC,KAAA,GAAAV,iBAAA,CAAG,aAAY;YACpC,IAAII,SAAS,GAAG,CAAC,EAAE;cACf,IAAI;gBACAA,SAAS,EAAE;gBACX,IAAMO,OAAO,SAASjB,kBAAkB,CAAC,CAAC;gBAE1C,IAAIO,OAAO,KAAK,EAAE,EAAE;kBAChBO,MAAM,CAAC,iCAAiC,CAAC;kBACzC;gBACJ;gBAEA,IAAMI,KAAK,GAAG;kBACV,SAAS,EAAED,OAAO;kBAClB,SAAS,EAAEV,OAAO;kBAClB,eAAe,EAAEC,UAAU;kBAC3B,cAAc,EAAEC;gBACpB,CAAC;gBAED,IAAMU,WAAW,SAASjB,yBAAyB,CAAC,CAAC;gBAErDH,KAAK,CAACqB,IAAI,CAACnB,cAAc,EAAEiB,KAAK,EAAE;kBAC9BG,OAAO,EAAE;oBACLC,aAAa,EAAG,UAASH,WAAY,EAAC;oBACtC,cAAc,EAAE;kBACpB;gBACJ,CAAC,CAAC,CACDI,IAAI,CAAC,UAAAC,QAAQ,EAAI;kBACd,IAAIA,QAAQ,CAACC,IAAI,CAACC,MAAM,KAAK,GAAG,EAAE;oBAC9BvB,kBAAkB,CAAC,CAAC;oBACpBY,mBAAmB,CAAC,CAAC;kBACzB,CAAC,MAAM;oBACHL,SAAS,GAAG,CAAC;oBACbG,OAAO,CAACW,QAAQ,CAACC,IAAI,CAAC;kBAC1B;gBACJ,CAAC,CAAC,CACDE,KAAK,CAAC,UAAAC,KAAK,EAAI;kBACZC,OAAO,CAACC,GAAG,CAACF,KAAK,CAACG,OAAO,CAAC;kBAC1BjB,MAAM,CAAC,mBAAmB,CAAC;gBAC/B,CAAC,CAAC;cACN,CAAC,CAAC,OAAOc,KAAS,EAAE;gBAChBd,MAAM,CAAC,wBAAwB,GAAGc,KAAK,CAACG,OAAO,CAAC;cACpD;YACJ,CAAC,MAAM;cACHjB,MAAM,CAAC,2CAA2C,CAAC;YACvD;UACJ,CAAC;UAAA,gBA7CKC,mBAAmBA,CAAA;YAAA,OAAAC,KAAA,CAAAgB,KAAA,OAAAC,SAAA;UAAA;QAAA,GA6CxB;QAEDlB,mBAAmB,CAAC,CAAC;MACzB,CAAC;MAAA,iBAAAmB,GAAA,EAAAC,GAAA;QAAA,OAAAvB,KAAA,CAAAoB,KAAA,OAAAC,SAAA;MAAA;IAAA,IAAC;EACN,CAAC;EAAA,gBArDY7B,WAAWA,CAAAgC,EAAA,EAAAC,GAAA,EAAAC,GAAA;IAAA,OAAAjC,IAAA,CAAA2B,KAAA,OAAAC,SAAA;EAAA;AAAA,GAqDvB"},"metadata":{},"sourceType":"module","externalDependencies":[]}